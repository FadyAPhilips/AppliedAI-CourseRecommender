{% extends "base.html" %}

{% block content %}
  <style>
    .search-header {
      background: var(--glass-bg);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: var(--space-xl);
      margin-bottom: var(--space-lg);
      border: 1px solid var(--glass-border);
    }

    .search-header h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--space-sm);
    }

    [data-theme="dark"] .search-header h2 {
      background: linear-gradient(135deg, #fff 0%, var(--primary-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    [data-theme="light"] .search-header h2 {
      background: linear-gradient(135deg, #1e293b 0%, var(--primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .search-container {
      margin-bottom: var(--space-xl);
    }

    .search-box {
      position: relative;
      margin-bottom: var(--space-lg);
    }

    .search-box input {
      width: 100%;
      padding: 1rem 1rem 1rem 3.5rem;
      font-size: 1.125rem;
      border-radius: 16px;
      border: 2px solid var(--border);
      background: var(--glass-bg);
      color: var(--text-primary);
      transition: all var(--transition-base);
    }

    .search-box input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 1.25rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.25rem;
      opacity: 0.5;
    }

    .filters-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .filter-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .sort-container {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      flex-wrap: wrap;
    }

    .results-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-md);
      padding: var(--space-md);
      background: var(--glass-bg);
      border-radius: 12px;
      border: 1px solid var(--glass-border);
    }

    .results-count {
      font-weight: 600;
      color: var(--primary-light);
    }

    .clear-filters-btn {
      background: transparent !important;
      border: 2px solid var(--border) !important;
      padding: 0.5rem 1rem !important;
      border-radius: 10px !important;
      font-size: 0.875rem !important;
      transition: all var(--transition-base) !important;
      color: var(--text-secondary) !important;
      box-shadow: none !important;
      font-weight: 600 !important;
    }

    .clear-filters-btn:hover {
      background: var(--bg-card-hover) !important;
      border-color: var(--primary) !important;
      color: var(--primary) !important;
      transform: translateY(-1px) !important;
    }

    [data-theme="light"] .clear-filters-btn {
      border-color: var(--primary) !important;
      color: var(--primary) !important;
    }

    [data-theme="light"] .clear-filters-btn:hover {
      background: rgba(102, 126, 234, 0.1) !important;
      border-color: var(--primary-dark) !important;
      color: var(--primary-dark) !important;
    }

    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: var(--space-lg);
    }

    .course-item {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: var(--space-lg);
      border: 1px solid var(--glass-border);
      transition: all var(--transition-base);
      cursor: pointer;
    }

    .course-item:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    [data-theme="light"] .course-item {
      background: rgba(255, 255, 255, 0.8);
      border-color: rgba(102, 126, 234, 0.2);
    }

    .course-item h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: var(--space-xs);
      color: var(--text-primary);
    }

    .course-code {
      color: var(--primary-light);
      font-weight: 700;
      font-size: 0.875rem;
      margin-bottom: var(--space-xs);
      display: block;
    }

    .course-description {
      color: var(--text-secondary);
      font-size: 0.9375rem;
      line-height: 1.6;
      margin-bottom: var(--space-md);
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .course-meta-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-bottom: var(--space-sm);
    }

    .meta-tag {
      padding: 0.25rem 0.75rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 500;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
    }

    .meta-tag.category { border-color: rgba(102, 126, 234, 0.3); }
    .meta-tag.difficulty { border-color: rgba(245, 87, 108, 0.3); }
    .meta-tag.credits { border-color: rgba(67, 227, 123, 0.3); }

    .course-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-top: var(--space-sm);
    }

    .skill-tag {
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      background: rgba(102, 126, 234, 0.1);
      color: var(--primary-light);
      border: 1px solid rgba(102, 126, 234, 0.2);
    }

    .no-results {
      text-align: center;
      padding: var(--space-2xl);
      color: var(--text-secondary);
    }

    .no-results h3 {
      font-size: 1.5rem;
      margin-bottom: var(--space-sm);
      color: var(--text-primary);
    }

    @media (max-width: 768px) {
      .course-grid {
        grid-template-columns: 1fr;
      }

      .filters-container {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <section class="search-header">
    <h2>üîç Browse All Courses</h2>
    <p class="subtle">Discover and filter through the entire MAC course catalog</p>
  </section>

  <div class="card search-container">
    <form method="get" action="/browse" id="browseForm">
      <div class="search-box">
        <span class="search-icon">üîé</span>
        <input 
          type="text" 
          name="q" 
          id="searchInput"
          placeholder="Search by course code, title, or skills..." 
          value="{{ query }}"
          autocomplete="off">
      </div>

      <div class="filters-container">
        <div class="filter-group">
          <label class="filter-label" for="category">Category</label>
          <select name="category" id="category">
            <option value="">All Categories</option>
            <option value="core" {% if filters.category == 'core' %}selected{% endif %}>Core</option>
            <option value="technical-elective" {% if filters.category == 'technical-elective' %}selected{% endif %}>Technical Elective</option>
            <option value="business" {% if filters.category == 'business' %}selected{% endif %}>Business</option>
            <option value="project" {% if filters.category == 'project' %}selected{% endif %}>Project</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label" for="delivery">Delivery Mode</label>
          <select name="delivery" id="delivery">
            <option value="">All Modes</option>
            <option value="in-person" {% if filters.delivery == 'in-person' %}selected{% endif %}>In-Person</option>
            <option value="online" {% if filters.delivery == 'online' %}selected{% endif %}>Online</option>
            <option value="hybrid" {% if filters.delivery == 'hybrid' %}selected{% endif %}>Hybrid</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label" for="difficulty">Difficulty</label>
          <select name="difficulty" id="difficulty">
            <option value="">All Levels</option>
            <option value="2" {% if filters.difficulty == '2' %}selected{% endif %}>Level 2 (Easier)</option>
            <option value="3" {% if filters.difficulty == '3' %}selected{% endif %}>Level 3 (Moderate)</option>
            <option value="4" {% if filters.difficulty == '4' %}selected{% endif %}>Level 4 (Advanced)</option>
            <option value="5" {% if filters.difficulty == '5' %}selected{% endif %}>Level 5 (Challenging)</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label" for="credits">Credits</label>
          <select name="credits" id="credits">
            <option value="">All Credits</option>
            <option value="3.0" {% if filters.credits == '3.0' %}selected{% endif %}>3.0 Credits</option>
            <option value="6.0" {% if filters.credits == '6.0' %}selected{% endif %}>6.0 Credits</option>
          </select>
        </div>
      </div>

      <div class="sort-container">
        <label class="filter-label">Sort By:</label>
        <select name="sort" id="sort" style="flex: 0 0 200px;">
          <option value="relevance" {% if sort_by == 'relevance' %}selected{% endif %}>Relevance</option>
          <option value="code" {% if sort_by == 'code' %}selected{% endif %}>Course Code</option>
          <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title (A-Z)</option>
          <option value="difficulty" {% if sort_by == 'difficulty' %}selected{% endif %}>Difficulty</option>
          <option value="popularity" {% if sort_by == 'popularity' %}selected{% endif %}>Popularity</option>
        </select>

        <button type="submit" style="margin-left: auto;">üîé Apply Filters</button>
        <button type="button" class="clear-filters-btn" onclick="clearFilters()">‚úï Clear All</button>
      </div>
    </form>
  </div>

  <div class="results-info">
    <div class="results-count">
      Found {{ results|length }} course{{ 's' if results|length != 1 else '' }}
    </div>
  </div>

  {% if results %}
    <div class="course-grid">
      {% for course in results %}
        <div class="course-item" onclick="showCourseDetails('{{ course.course_id }}')">
          <span class="course-code">{{ course.course_code }}</span>
          <h3>{{ course.title }}</h3>
          <p class="course-description">{{ course.description }}</p>
          
          <div class="course-meta-tags">
            <span class="meta-tag category">{{ course.category|title }}</span>
            <span class="meta-tag difficulty">Level {{ course.difficulty_level }}</span>
            <span class="meta-tag credits">{{ course.credits }} Credits</span>
            <span class="meta-tag">{{ course.delivery_mode|title }}</span>
          </div>

          {% if course.skills %}
            <div class="course-skills">
              {% for skill in course.skills[:4] %}
                <span class="skill-tag">{{ skill }}</span>
              {% endfor %}
              {% if course.skills|length > 4 %}
                <span class="skill-tag">+{{ course.skills|length - 4 }} more</span>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card no-results">
      <h3>No courses found</h3>
      <p>Try adjusting your search criteria or clearing filters</p>
    </div>
  {% endif %}

  <div class="actions" style="margin-top: var(--space-xl); justify-content: center;">
    <form method="get" action="/">
      <button type="submit">‚Üê Back to Home</button>
    </form>
  </div>

  <script>
    // Auto-submit on filter change
    const form = document.getElementById('browseForm');
    const selects = form.querySelectorAll('select');
    
    selects.forEach(select => {
      select.addEventListener('change', () => {
        form.submit();
      });
    });

    // Search with debounce
    let searchTimeout;
    const searchInput = document.getElementById('searchInput');
    
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        form.submit();
      }, 500);
    });

    function clearFilters() {
      window.location.href = '/browse';
    }

    function showCourseDetails(courseId) {
      // Future: Could open a modal with full course details
      console.log('Show details for:', courseId);
    }
  </script>
{% endblock %}

